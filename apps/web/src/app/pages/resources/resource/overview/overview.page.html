<ng-container *ngIf="context.resource">
  <nz-row [nzGutter]="[24, 24]" nzAlign="top">
    <nz-col nzXs="24" nzSm="24" nzMd="20" nzLg="20" nzXl="20">
      <section *ngIf="context.resource.type === 'CIRCLE'">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Suivi de l'État des Ressources</mat-card-title>
            <mat-card-subtitle>
              Tenir à jour les statuts des ressources aide à s'assurer que les enseignants peuvent rapidement trouver
              des ressources fiables pour leurs cours. Contribuez à la qualité de la plateforme en mettant à jour le
              statut de vos ressources.
            </mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div
              *ngIf="statusChart"
              class="echarts"
              coreEcharts
              [autoResize]="false"
              [options]="statusChart"
              (chartClick)="onClickedStatus($event)"
            ></div>
          </mat-card-content>
        </mat-card>
      </section>
      <section *ngIf="dashboard">
        <nz-row [nzGutter]="[24, 24]" nzAlign="top">
          <nz-col nzXs="24" nzSm="24" nzMd="8" nzLg="8" nzXl="8">
            <ui-statistic-card
              matIcon="check_circle"
              ribbonColor="#8e44ad"
              valueSuffix="%"
              description="Taux de réussite"
              tooltip="Pourcentage des exercices complétées avec une note de 100."
              [value]="dashboard.session.successRate"
              [shouldBePositive]="true"
            />
          </nz-col>
          <nz-col nzXs="24" nzSm="24" nzMd="8" nzLg="8" nzXl="8">
            <ui-statistic-card
              matIcon="star"
              ribbonColor="#7f8c8d"
              description="Note moyenne"
              [value]="dashboard.session.averageScore"
              tooltip="Moyenne du score sur l'ensemble des sessions complétées."
              [shouldBePositive]="true"
            />
          </nz-col>
          <nz-col nzXs="24" nzSm="24" nzMd="8" nzLg="8" nzXl="8">
            <ui-statistic-card
              matIcon="access_time"
              ribbonColor="#f39c12"
              description="Durée moyenne"
              [value]="dashboard.session.averageDuration | duration"
            />
          </nz-col>
          <ng-container *ngIf="dashboard.exercise">
            <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
              <ui-statistic-card
                matIcon="thumb_up"
                ribbonColor="#f1c40f"
                valueSuffix="%"
                description="Taux de réponses"
                tooltip="Pourcentage des exercices avec au moins une réponse."
                [value]="dashboard.exercise.answerRate"
                [shouldBePositive]="true"
              />
            </nz-col>

            <nz-col nzXs="24" nzSm="24" nzMd="12" nzLg="12" nzXl="12">
              <ui-statistic-card
                matIcon="thumb_down"
                ribbonColor="#16a085"
                valueSuffix="%"
                description="Taux d'abandon"
                tooltip="Pourcentage des exercices sans aucune réponse."
                [value]="dashboard.exercise.dropoutRate"
                [shouldBeZero]="true"
              />
            </nz-col>
          </ng-container>

          <ng-container *ngIf="dashboard.activity">
            <nz-col>
              <h2>Résultat par exercices</h2>
            </nz-col>
            <nz-col nzSpan="24">
              <result-by-exercises [results]="dashboard.activity.exerciseResults" />
            </nz-col>
          </ng-container>

          <nz-col nzSpan="24">
            <h2>Évolution des notes et du temps d'apprentissage</h2>
          </nz-col>
          <nz-col nzSpan="24">
            <mat-card>
              <mat-card-header>
                <nz-select [(ngModel)]="learningInsightsOption">
                  <nz-option nzValue="score" nzLabel="Note moyenne" />
                  <nz-option nzValue="duration" nzLabel="Temps d'apprentissage" />
                </nz-select>
                <nz-date-picker nzMode="month" [(ngModel)]="learningInsightsDate" />
              </mat-card-header>
              <mat-card-content>
                <br />
                <result-value-distribution
                  *ngIf="learningInsightsOption === 'score'"
                  legend="Note moyenne"
                  [date]="learningInsightsDate"
                  [distribution]="dashboard.session.scoreDistribution"
                />
                <result-value-distribution
                  *ngIf="learningInsightsOption === 'duration'"
                  legend="Temps d'apprentissage"
                  [date]="learningInsightsDate"
                  [isTimeValues]="true"
                  [color]="'#FF0087'"
                  [colorGradient]="['rgb(255, 0, 135)', 'rgb(135, 0, 157)']"
                  [distribution]="dashboard.session.durationDistribution"
                />
              </mat-card-content>
            </mat-card>
          </nz-col>
          <nz-col nzSpan="24">
            <h2>Répartition des résultats</h2>
          </nz-col>
          <nz-col nzSpan="24">
            <mat-card>
              <mat-card-content>
                <result-answer-distribution [distribution]="dashboard.session.answerDistribution" />
              </mat-card-content>
            </mat-card>
          </nz-col>
        </nz-row>
      </section>
      <section>
        <mat-card>
          <mat-card-header>
            <mat-card-title>Tags</mat-card-title>
            <mat-card-subtitle
              >Les tags (topics et niveaux) permettent une classification et une organisation plus efficace de vos
              ressources.</mat-card-subtitle
            >
          </mat-card-header>
          <mat-card-content>
            <nz-empty
              *ngIf="!context.resource.levels.length && !context.resource.topics.length"
              [nzNotFoundContent]="noTags"
              [nzNotFoundFooter]="noTagsFooter"
            >
              <ng-template #noTags>
                Il est donc important d'ajouter des tags à vos créations pour en faciliter la recherche et la découverte
                par d'autres enseignants.
              </ng-template>
              <ng-template #noTagsFooter>
                <button
                  *ngIf="context.resource.permissions.write"
                  nz-button
                  nzType="primary"
                  [routerLink]="['../settings']"
                  [queryParams]="{ tab: 'informations' }"
                >
                  Ajouter des tags
                </button>
              </ng-template>
            </nz-empty>
            <mat-chip-set>
              <ng-container *ngFor="let item of context.resource.levels; trackBy: trackById">
                <mat-chip
                  [routerLink]="['/resources']"
                  [queryParams]="{ q: item.name, parents: context.resource.id }"
                  [queryParamsHandling]="'merge'"
                >
                  {{ item.name }}
                </mat-chip>
              </ng-container>
              <ng-container *ngFor="let item of context.resource.topics; trackBy: trackById">
                <mat-chip
                  [routerLink]="['/resources']"
                  [queryParams]="{ q: item.name, parents: context.resource.id }"
                  [queryParamsHandling]="'merge'"
                >
                  {{ item.name }}
                </mat-chip>
              </ng-container>
            </mat-chip-set>
          </mat-card-content>
        </mat-card>
      </section>
    </nz-col>
    <nz-col nzXs="24" nzSm="24" nzMd="4" nzLg="4" nzXl="4">
      <aside>
        <nz-row [nzGutter]="[24, 24]">
          <nz-col nzSpan="24">
            <ui-statistic-card
              matIcon="visibility"
              ribbonColor="#8e44ad"
              description="Observateurs"
              tooltip="Nombre de personnes ayant cliqué sur le bouton 'Suivre' de cette ressource."
              [value]="context.statistic?.watchers ?? 0"
            />
          </nz-col>
          <nz-col nzSpan="24">
            <ui-statistic-card
              matIcon="group"
              ribbonColor="#f1c40f"
              description="Collaborateurs"
              tooltip="Nombre de personnes ayant des droits d'édition sur cette ressource."
              [value]="context.statistic?.members ?? 0"
            />
          </nz-col>
          <ng-container *ngIf="dashboard?.activity">
            <nz-col nzSpan="24">
              <ui-statistic-card
                matIcon="local_library"
                ribbonColor="#349d55"
                description="Cours"
                tooltip="Nombre de cours dans lesquels cette activité est utilisée."
                [value]="dashboard!.activity!.usedInCoursesCount ?? 0"
              />
            </nz-col>
          </ng-container>
          <ng-container *ngIf="context.resource.type === 'CIRCLE'">
            <nz-col nzSpan="24">
              <ui-statistic-card
                matIcon="group_work"
                ribbonColor="#16a085"
                description="Cercles enfants"
                tooltip="Nombre de cercles directement liés à ce cercle."
                [value]="context.statistic?.circles ?? 0"
              >
                <a
                  nz-button
                  [routerLink]="['/resources']"
                  [queryParams]="{ types: 'CIRCLE', parents: context.resource.id }"
                  [queryParamsHandling]="'merge'"
                >
                  Afficher la liste
                </a>
              </ui-statistic-card>
            </nz-col>

            <nz-col nzSpan="24">
              <ui-statistic-card
                matIcon="widgets"
                ribbonColor="#34495e"
                description="Activités"
                tooltip="Nombre d'activités directement liées à ce cercle."
                [value]="context.statistic?.activities ?? 0"
              >
                <a
                  nz-button
                  [routerLink]="['/resources']"
                  [queryParams]="{ types: 'ACTIVITY', parents: context.resource.id }"
                  [queryParamsHandling]="'merge'"
                >
                  Afficher la liste
                </a>
              </ui-statistic-card>
            </nz-col>

            <nz-col nzSpan="24">
              <ui-statistic-card
                matIcon="article"
                ribbonColor="#c0392b"
                description="Exercices"
                tooltip="Nombre d'exercices directement liés à ce cercle."
                [value]="context.statistic?.exercises ?? 0"
              >
                <a
                  nz-button
                  [routerLink]="['/resources']"
                  [queryParams]="{ types: 'EXERCISE', parents: context.resource.id }"
                  [queryParamsHandling]="'merge'"
                >
                  Afficher la liste
                </a>
              </ui-statistic-card>
            </nz-col>
          </ng-container>
        </nz-row>
      </aside>
    </nz-col>
  </nz-row>
</ng-container>
