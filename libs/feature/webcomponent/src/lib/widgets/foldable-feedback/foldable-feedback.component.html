<div class="foldable-feedback" *ngFor="let item of state.content; let index = index">
  <ng-container *ngTemplateOutlet="feedback; context: { item: item, indexes: '' + index }"> </ng-container>
</div>
<wc-base [(state)]="state"></wc-base>

<ng-template #feedback let-item="item" let-indexes="indexes">
  <div
    class="feedback"
    [class]="(item.type ? item.type : 'info') + ' ' + (item.display ? 'opened' : 'closed')"
    (click)="onClick(indexes)"
  >
    <h2>
      <mat-icon>
        {{ item.display ? 'expand_less' : 'expand_more' }}
      </mat-icon>
      {{ item.name }}
      <mat-icon class="feedback-type-icon" [ngClass]="item.type ? item.type : 'info'">
        {{ getIconForType(item.type ? item.type : 'info') }}
      </mat-icon>
    </h2>
    <div [class]="item.display ? 'show' : 'hide'">
      @if (item.feedbacks && item.feedbacks.length > 0){
      <div *ngIf="item.description" class="description">
        <pre>{{ item.description }}</pre>
      </div>
      <div *ngFor="let child of item.feedbacks; let index = index">
        <ng-container *ngTemplateOutlet="feedback; context: { item: child, indexes: indexes + '-' + index }">
        </ng-container>
      </div>
      } @else {
      <div *ngIf="item.description">
        <pre>{{ item.description }}</pre>
      </div>
      <div *ngIf="item.arguments">
        <h3>Arguments :</h3>
        <pre class="args" (mousedown)="$event.stopPropagation()">{{ item.arguments }}</pre>
      </div>
      <div *ngIf="item.expected">
        <h3>Attendu :</h3>
        <pre
          class="code"
          (mousedown)="$event.stopPropagation()"
          [innerHTML]="item.showHiddenCharacters ? formatTextHtml(item.expected) : item.expected"
        ></pre>
      </div>
      <div *ngIf="item.obtained">
        <h3>Obtenu :</h3>
        <pre
          class="code"
          (mousedown)="$event.stopPropagation()"
          [innerHTML]="item.showHiddenCharacters ? formatTextHtml(item.obtained) : item.obtained"
        ></pre>
      </div>
      }
    </div>
  </div>
</ng-template>
