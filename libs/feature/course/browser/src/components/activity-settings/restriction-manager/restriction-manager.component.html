<nz-row [nzGutter]="16" class="restrictions-container">
  <div nz-col [nzSpan]="24">
    <!-- La restriction principale -->
    <nz-card *ngIf="!isSubRestriction && restrictions.length > 0" [nzBordered]="false" [nzTitle]="titleTemplate">
      <ng-template #titleTemplate>
        <h4 nz-typography>Restriction principale</h4>
      </ng-template>

      <div *ngFor="let restriction of restrictions; let i = index" class="restriction-item">
        <course-restriction
          *ngIf="restriction.type !== 'Jeu'"
          [restriction]="restriction"
          [courseGroups]="courseGroups"
          [courseMembers]="courseMembers"
          [isSubRestriction]="isSubRestriction"
          (remove)="removeRestriction(i)"
        >
        </course-restriction>

        <nz-card
          *ngIf="restriction.type === 'Jeu'"
          class="sub-restriction-card"
          [nzTitle]="subRestrictionTitle"
          [nzBordered]="false"
        >
          <ng-template #subRestrictionTitle>
            <div class="sub-restriction-header">
              <span nz-typography>Sous restriction</span>
              <button nz-button nzType="primary" nzDanger nzShape="circle" (click)="removeRestriction(i)">
                <i nz-icon nzType="delete"></i>
              </button>
            </div>
          </ng-template>

          <div *ngIf="restriction.restrictions && restriction.restrictions.length > 0">
            <course-restriction-manager
              [restrictions]="restriction.restrictions"
              [courseGroups]="courseGroups"
              [courseMembers]="courseMembers"
              [condition]="restriction.condition"
              [allConditions]="restriction.allConditions"
              [isSubRestriction]="true"
              (restrictionAdded)="onSubRestrictionAdded(i)"
            >
            </course-restriction-manager>
          </div>

          <course-propositions
            *ngIf="isOpenProposition"
            (closeEvent)="closeBottomSheet()"
            (sendEvent)="selectOption(i, $event)"
          >
          </course-propositions>

          <div class="add-restriction-button">
            <button nz-button nzType="dashed" nzBlock (click)="openBottomSheet()">
              <i nz-icon nzType="plus"></i>
              Ajouter une sous-restriction
            </button>
          </div>
        </nz-card>
      </div>
    </nz-card>

    <!-- Les sous-restrictions -->
    <nz-card *ngIf="isSubRestriction" [nzBordered]="false">
      <div *ngFor="let restriction of restrictions; let i = index" class="restriction-item">
        <course-restriction
          *ngIf="restriction.type !== 'Jeu'"
          [restriction]="restriction"
          [courseGroups]="courseGroups"
          [courseMembers]="courseMembers"
          [isSubRestriction]="isSubRestriction"
          (remove)="removeRestriction(i)"
        >
        </course-restriction>

        <nz-card
          *ngIf="restriction.type === 'Jeu'"
          class="sub-restriction-card"
          [nzTitle]="subRestrictionTitle"
          [nzBordered]="false"
        >
          <ng-template #subRestrictionTitle>
            <div class="sub-restriction-header">
              <span nz-typography>Sous restriction</span>
              <button nz-button nzType="primary" nzDanger nzShape="circle" (click)="removeRestriction(i)">
                <i nz-icon nzType="delete"></i>
              </button>
            </div>
          </ng-template>

          <div *ngIf="restriction.restrictions && restriction.restrictions.length > 0">
            <course-restriction-manager
              [restrictions]="restriction.restrictions"
              [courseGroups]="courseGroups"
              [courseMembers]="courseMembers"
              [condition]="restriction.condition"
              [allConditions]="restriction.allConditions"
              [isSubRestriction]="true"
              (restrictionAdded)="onSubRestrictionAdded(i)"
            >
            </course-restriction-manager>
          </div>

          <course-propositions
            *ngIf="isOpenProposition"
            (closeEvent)="closeBottomSheet()"
            (sendEvent)="selectOption(i, $event)"
          >
          </course-propositions>

          <div class="add-restriction-button">
            <button nz-button nzType="dashed" nzBlock (click)="openBottomSheet()">
              <i nz-icon nzType="plus"></i>
              Ajouter une sous-restriction
            </button>
          </div>
        </nz-card>
      </div>
    </nz-card>
  </div>
</nz-row>
