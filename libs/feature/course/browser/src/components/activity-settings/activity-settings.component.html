<div class="page-container">
  <div>
    <div>
      <section>
        <div class="color-section">
          <course-color-picker [hue]="currentHue" (hueChange)="onHueChange($event)"></course-color-picker>
        </div>
        <div class="example-button-row">
          <div class="data-form">
            @for(restriction of restrictions; track restriction; let i = $index) {
            <course-restriction-manager
              [activity]="activity"
              [courseGroups]="courseGroups"
              [courseMembers]="courseMembers"
              [restrictions]="restriction.restriction"
              [index]="i"
              (sendRestrictions)="updateRestriction(i, $event)"
            >
            </course-restriction-manager>
            }
          </div>

          <nz-button-group>
            <button nz-button [nzType]="'primary'" (click)="newRestriction()">
              <span nz-icon nzType="plus"></span>
              Ajouter une restriction
            </button>
          </nz-button-group>
        </div>
      </section>
    </div>

    <nz-spin *ngIf="updating" nzTip="Modification de l'activité..."></nz-spin>
    <div class="actions">
      <button nz-button [disabled]="!form.valid" nzType="primary" (click)="update()">
        Appliquer les modifications
      </button>
      <div class="spacer"></div>
      <button
        nz-button
        nzDanger
        nz-popconfirm
        [nzPopconfirmTitle]="confirmReload"
        nzPopconfirmPlacement="top"
        (nzOnConfirm)="reload()"
      >
        Recharger
      </button>
      <button
        nz-button
        nzDanger
        nzType="primary"
        nz-popconfirm
        [nzPopconfirmTitle]="confirmDelete"
        nzPopconfirmPlacement="top"
        (nzOnConfirm)="delete()"
      >
        Supprimer
      </button>
    </div>
    <button
      nz-button
      nzDanger
      nzType="primary"
      nz-popconfirm
      [nzPopconfirmTitle]="confirmClose"
      nzPopconfirmPlacement="right"
      (nzOnConfirm)="close()"
    >
      Fermer l'activité
    </button>
    <button
      nz-button
      nzDanger
      nzType="primary"
      nz-popconfirm
      [nzPopconfirmTitle]="confirmReopen"
      nzPopconfirmPlacement="right"
      (nzOnConfirm)="reopenForAll()"
    >
      Rouvrir l'activité pour tous
    </button>
  </div>

  <ng-template #confirmReload>
    <p>Êtes-vous sûr de vouloir recharger cette activité ?</p>
    <ul>
      <li>L'activité sera remplacée par sa dernière version publiée.</li>
      <li>Après avoir supprimé l'activité, toutes ses réponses seront effacées.</li>
    </ul>
  </ng-template>

  <ng-template #confirmDelete>
    <p>Êtes-vous sûr de vouloir supprimer cette activité ?</p>
    <p>Après avoir supprimé l'activité, toutes ses réponses seront effacées.</p>
  </ng-template>

  <ng-template #confirmClose>
    <p>Êtes-vous sûr de vouloir fermer cette activité ?</p>
  </ng-template>

  <ng-template #confirmReopen>
    <div>
      <p>Êtes-vous sûr de vouloir rouvrir cette activité pour tous?</p>
      <p>
        La date de fin de l'activité sera automatiquement supprimée, si vous souhaiter la remettre en place, vous devrez
        le faire manuellement.
      </p>
    </div>
  </ng-template>
</div>
