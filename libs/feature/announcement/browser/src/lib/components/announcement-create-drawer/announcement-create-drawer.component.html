<div class="container">
  <div class="header">
    <button nz-button class="close-button" nzType="primary" (click)="close()">
      <span>Fermer</span>
    </button>

    <div class="save-state">
      @if (hasUnsavedChanges) {
      <mat-icon class="turn" matTooltip="Modifications non sauvegardées" matTooltipClass="tooltip">edit</mat-icon>
      } @else {
      <mat-icon matTooltip="Aucune modification" matTooltipClass="tooltip">check</mat-icon>
      }
    </div>
  </div>

  <h1>{{ dialogTitle }}</h1>

  <form nz-form [formGroup]="form" (ngSubmit)="save()">
    <nz-spin [nzSpinning]="loading">
      <!-- Titre -->
      <nz-form-item>
        <nz-form-label nzRequired nzFor="title">Titre</nz-form-label>
        <nz-form-control nzErrorTip="Veuillez saisir un titre">
          <input nz-input formControlName="title" id="title" placeholder="Titre de l'annonce" />
        </nz-form-control>
      </nz-form-item>

      <!-- Description -->
      <nz-form-item class="vertical-label">
        <nz-form-label nzRequired nzFor="description">Description brève</nz-form-label>
        <nz-form-control nzErrorTip="Veuillez saisir une description">
          <textarea
            nz-input
            [nzAutosize]="{ minRows: 2, maxRows: 6 }"
            formControlName="description"
            id="description"
            placeholder="Description courte de l'annonce"
          ></textarea>
        </nz-form-control>
      </nz-form-item>

      <div class="spacer"></div>
      <!-- Actif -->
      <nz-form-item>
        <nz-form-label nzFor="active">Actif</nz-form-label>
        <nz-form-control>
          <nz-switch formControlName="active"></nz-switch>
        </nz-form-control>
      </nz-form-item>

      <!-- Partie du formulaire pour la sélection des rôles cibles -->
      <nz-form-item>
        <nz-form-label class="role" nzFor="targetedRoles">Rôles ciblés</nz-form-label>
        <nz-form-control>
          <div class="role-checkboxes">
            <!-- Admin role -->
            <label nz-checkbox formControlName="targetAdmins" (ngModelChange)="updateTargetedRoles()">
              <nz-tag [nzColor]="getRoleColor('admin')">{{ formatRoleName('admin') }}</nz-tag>
            </label>

            <!-- Teacher role -->
            <label nz-checkbox formControlName="targetTeachers" (ngModelChange)="updateTargetedRoles()">
              <nz-tag [nzColor]="getRoleColor('teacher')">{{ formatRoleName('teacher') }}</nz-tag>
            </label>

            <!-- Student role -->
            <label nz-checkbox formControlName="targetStudents" (ngModelChange)="updateTargetedRoles()">
              <nz-tag [nzColor]="getRoleColor('student')">{{ formatRoleName('student') }}</nz-tag>
            </label>
          </div>
        </nz-form-control>
      </nz-form-item>
    </nz-spin>
  </form>
  <h2>Contenu de l'annonce</h2>
  <ui-editorjs *ngIf="terms" [ngModel]="terms" (ngModelChange)="onChangeData($event)"></ui-editorjs>

  <div class="button-container">
    <button nz-button nzType="primary" type="submit" [disabled]="loading" (click)="save()">
      {{ submitButtonText }}
    </button>
    <button nz-button type="button" (click)="close()">Annuler</button>
  </div>
</div>
