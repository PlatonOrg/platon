<mat-drawer-container>
  <mat-drawer mode="side" opened #drawer>
    <!-- <nav>
      <ng-container *ngFor="let entry of exerciseGroups.entries()">
        <span class="nav-link activity-name">{{ entry[0] }}</span>
        <ng-container *ngFor="let ex of entry[1]">
          <button
            (click)="onChooseGroup(ex)"
            mat-button
            class="nav-link"
            [class.active]="ex.exerciseId === currentGroup?.exerciseId"
          >
            <div class="nav-link-content">
              <div class="icon-container">
                <mat-icon [style.color]="ex.graded ? 'green' : 'white'">
                  {{ ex.graded ? 'check_circle' : 'cancel' }}
                </mat-icon>
              </div>
              <div class="exercise-name">
                {{ ex.exerciseName }}
              </div>
            </div>
          </button>
        </ng-container>
      </ng-container>
    </nav> -->
    <nav>
      <img class="logo" src="assets/images/logo/platon.svg" alt="Logo PLaTon" [routerLink]="'/dashboard'" />
      <h2>Corrections</h2>
      <nz-collapse class="panel-wrapper" [nzBordered]="false">
        @for (entry of activityExercisesMap.entries(); track entry[0]) {
        <nz-collapse-panel
          [nzHeader]="entry[1].name"
          [nzActive]="entry[0] === activityExercisesMap.keys().next().value"
        >
          <ng-container *ngFor="let ex of entry[1].map.entries()">
            <button
              (click)="onChooseGroup(ex[1])"
              mat-button
              class="nav-link"
              [class.active]="ex[0] === currentGroup?.exerciseId"
            >
              <div class="nav-link-content">
                <div class="icon-container">
                  <mat-icon [style.color]="ex[1].graded ? 'green' : 'white'">
                    {{ ex[1].graded ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                </div>
                <div class="exercise-name">{{ ex[1].exerciseName }}</div>
              </div>
            </button>
          </ng-container>
        </nz-collapse-panel>
        }
      </nz-collapse>
    </nav>
  </mat-drawer>
  <mat-drawer-content>
    <mat-toolbar>
      <button mat-icon-button (click)="onChoosePreviousUserExercise()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <nz-select
        class="student-name"
        [ngModel]="currentUser?.id"
        (ngModelChange)="loadUserExercise($event)"
        [nzOptions]="userOptions"
      >
      </nz-select>
      <button mat-icon-button (click)="onChooseNextUserExercise()">
        <mat-icon>chevron_right</mat-icon>
      </button>

      <div class="setting-button">
        <button mat-icon-button>
          <mat-icon>settings</mat-icon>
        </button>
      </div>
    </mat-toolbar>
    <main>
      <nz-row>
        <nz-col nzSpan="17" class="comment-wrapper">
          <h3>Commentaire</h3>
          <!-- TODO : Fix this, it's weird -->
          <player-comments
            *ngIf="answers.length > 0"
            [canComment]="true"
            [answerId]="answers[answers.length - 1].answerId!"
            [sessionId]="answers[answers.length - 1].sessionId"
          />
        </nz-col>
        <nz-col nzSpan="6">
          <div class="grade-wrapper">
            <h3>Note</h3>
            <ui-statistic-card
              matIcon="check_circle"
              ribbonColor="#8e44ad"
              description="Note attribuées à l'élève"
              [value]="grade"
              shouldBePositive
            />
          </div>
        </nz-col>
        <nz-col nzSpan="1">
          <nz-button-group nzSize="small" class="button-wrapper">
            <button
              nz-button
              nzBlock
              *ngFor="let i of [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]"
              (click)="grade = i"
            >
              {{ i }}
            </button>
          </nz-button-group>
        </nz-col>
      </nz-row>
      <nz-row>
        <nz-col nzSpan="17">
          <player-review #player [players]="answers" [reviewMode]="true" [canComment]="true" class="sized" />
        </nz-col>
        <nz-col nzSpan="7">
          <div class="label-container">
            <div class="etiquette-wrapper">
              <h3>Étiquette</h3>
              <!-- <ng-container *ngFor="let etiquette of etiquettes">
              <nz-tag [nzColor]="etiquette.color" nzMode="checkable" [nzChecked]="etiquette.checked" (nzChange)="handleChange($event, etiquette)">
                {{ etiquette.label }}
              </nz-tag>
            </ng-container> -->
            </div>
          </div>
        </nz-col>
      </nz-row>
    </main>
    <!--
    <main>
      <nz-segmented
        #segmented
        [ngModel]="selectedTabIndex"
        (ngModelChange)="onChooseTab($event)"
        [nzOptions]="['Corrections en attente', 'Corrections terminées']"
      />
      <ng-container *ngIf="exercises.length as exerciseCount; else noExercises">
        <ng-container>
          <nz-ribbon *ngIf="answers.length as answerCount; else noAnswers" [nzText]="ribbon">
            <ng-template #ribbon>
              Exercice : {{ selectedExerciseIndex + 1 }}/{{ exerciseCount }}&nbsp; Réponse :
              {{ player.currentAttemptIndex + 1 }}/{{ answerCount }}
            </ng-template>
            <h1>aaaaa</h1>
            <player-review #player [players]="answers" [reviewMode]="true" [canComment]="true" class="sized" />
            <h1>aaaaa</h1>
          </nz-ribbon>
          <footer *ngIf="currentExercise">
            <h3>Note grader ({{ currentExercise.grade }})</h3>
            <nz-slider
              [disabled]="true"
              [(ngModel)]="currentExercise.grade"
              [nzMarks]="{ '-1': '-1', '100': '100' }"
              nzMin="-1"
              nzMax="100"
            />
            <h3>Note ajustée ({{ correctedGrade }})</h3>
            <nz-slider [nzMarks]="{ '-1': '-1', '100': '100' }" [(ngModel)]="correctedGrade" nzMin="-1" nzMax="100" />
            <mat-toolbar>
              <button (click)="onSaveGrade()" mat-raised-button color="primary">Enregistrer</button>
              <button *ngIf="selectedExerciseIndex > 0" mat-raised-button (click)="onChoosePreviousExercise()">
                <mat-icon>arrow_back</mat-icon>
                Utilisateur précédent
              </button>
              <button
                *ngIf="selectedExerciseIndex < exerciseCount - 1"
                mat-raised-button
                (click)="onChooseNextExercise()"
              >
                <mat-icon>arrow_forward</mat-icon>
                Utilisateur suivant
              </button>
            </mat-toolbar>
          </footer>
        </ng-container>
        <ng-template #noAnswers>
          <nz-ribbon [nzText]="ribbon">
            <ng-template #ribbon> Exercice : {{ selectedExerciseIndex + 1 }}/{{ exerciseCount }} </ng-template>
            <nz-empty [nzNotFoundContent]="content">
              <ng-template #content> L'élève n'a pas répondu à cet exercice </ng-template>
            </nz-empty>
          </nz-ribbon>
        </ng-template>
      </ng-container>
    </main>-->
  </mat-drawer-content>
</mat-drawer-container>

<ng-template #noExercises>
  <div [ngSwitch]="selectedTabIndex">
    <ng-container *ngSwitchCase="0">
      <ng-container [ngTemplateOutlet]="noPendings" />
    </ng-container>
    <ng-container *ngSwitchCase="1">
      <ng-container [ngTemplateOutlet]="noCorrections" />
    </ng-container>
  </div>
</ng-template>

<ng-template #noPendings>
  <nz-empty [nzNotFoundContent]="content">
    <ng-template #content>
      Félicitations, vous avez terminé toutes les corrections qui vous ont été attribuées sur l'exercice
      <b> {{ currentGroup?.exerciseName }} </b>!
    </ng-template>
  </nz-empty>
</ng-template>

<ng-template #noCorrections>
  <nz-empty [nzNotFoundContent]="content">
    <ng-template #content> Aucune correction disponible ! </ng-template>
  </nz-empty>
</ng-template>
